<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Memomry Cards Game</title>
  </head>

  <style>
    .room-content {
      display: none;
    }
  </style>
  <body>
    <div>
      <div class="main-content" id="main-content">
        <div role="alert" id="turn-message"></div>

        <div id="user-card">
          <div>
            <form method="POST" id="form">
              <div>
                <label for="username">Nom d'utilisateur</label>
                <input
                  type="text"
                  id="username"
                  minlength="2"
                  maxlength="20"
                  placeholder="Saisir votre nom d'utilisateur"
                  required
                />
              </div>
              <button id="savePseudo" type="submit">Enregistrer pseudo</button>
              <button id="createRoomButton">Create Room</button>
<input type="text" id="roomNameInput" placeholder="Enter room name">

            </form>
          </div>
        </div>

        <div id="rooms-card">
          <div>Salons disponibles</div>
          <ul id="rooms-list"></ul>
        </div>
      </div>
      <div class="room-content">
        <h2>Vous Ãªtes dans la salle :<span> </span></h2>
        <button id="leaveButton">Leave Room</button>
        <button id="startGameButton" style="display: none;">Start Game</button>

        <div id="game-area">
          <div id="game-board"></div>
        </div>
      </div>
    </div>
  </body>
  <script
    src="https://cdn.socket.io/4.7.5/socket.io.min.js"
    integrity="sha384-2huaZvOR9iDzHqslqwpR87isEmrfxqyWOF7hr7BY6KG0+hVKLoEXMPUJw3ynWuhO"
    crossorigin="anonymous"
  ></script>

  <script>
    const socket = io();
    let currentRoom;


    document
      .getElementById("form")
      .addEventListener("submit", function (event) {
        event.preventDefault();
        let username = document.getElementById("username").value;
        socket.emit("setUsername", username);
      });

      document.getElementById('createRoomButton').addEventListener('click', function(event) {
            event.preventDefault();
            const roomName = document.getElementById('roomNameInput').value;
            if (roomName) {
                socket.emit('createRoom', roomName);
            } else {
                console.log('Please enter a room name');
            }
        });


      document.getElementById('leaveButton').addEventListener('click', function() {
            if (currentRoom) {
                socket.emit('leave', currentRoom);
                document.querySelector('.room-content').style.display = 'none';
                document.querySelector('.main-content').style.display = 'block';
            }
        });

///sockets

    socket.on('connect', function() {
        socket.emit('getRooms');
    });
    

    socket.on('roomsList', (rooms) => {
    const roomsList = document.getElementById('rooms-list');
    roomsList.innerHTML = ''; 
    rooms.forEach(({ room, creator, isFull }) => { 
        const creator_details_room = document.createElement('li');
        creator_details_room.textContent = room + ' created by ' + creator;

        const joinButton = document.createElement('button');
        joinButton.textContent = 'Join Room';

        if (isFull) {
            joinButton.disabled = true;
            const space = document.createElement('span');
            space.textContent = ' (Full)';
            creator_details_room.appendChild(space);

        }

        joinButton.addEventListener('click', () => {
            if (!isFull) {
                currentRoom = room; 
                socket.emit('joinRoom', room);
                document.querySelector('.main-content').style.display = 'none';
                document.querySelector('.room-content').style.display = 'block';
            }
        });

        roomsList.appendChild(creator_details_room);
        roomsList.appendChild(joinButton);
    });
});

    socket.on("userJoined", ({ user, room }) => {
      const message = document.createElement("p");
      message.textContent = `${user} has joined ${room}`;
      document.querySelector(".room-content").appendChild(message);

      document.querySelector("h2 span").textContent = " " + room ;
    });

//     socket.on('roomFull', () => {
//     alert('The room is full');
//     document.querySelector('.main-content').style.display = 'block';
//     document.querySelector('.room-content').style.display =  'none' ;
// });

    socket.on("leave", function ({ user, room }) {
      console.log(`${user} has left ${room}`);

        const message = document.createElement("p");
        message.textContent = `${user} has left ${room}`;
        document.querySelector(".room-content").appendChild(message);

    });

    // Game logic
    const startGameButton = document.getElementById('startGameButton');

    startGameButton.addEventListener('click', function() {
        if (currentRoom) {
        socket.emit('startGame', currentRoom);
        }
    });

    socket.on('roomFull', () => {
        startGameButton.style.display = 'block';
    });
    socket.on('roomFullAndCannotJoin', () => {
        alert('The room is full');
    });

    socket.on('gameStarted', () => {
        // Start the game here
    });

</script>

</html>
